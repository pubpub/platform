---
import type { NonGenericProcessedPub } from "contracts";

import type { FileUpload } from "../layouts/Layout.astro";

export interface Props {
	title: string;
	doi?: string;
	issueNumber?: string;
	publicationDate?: string;
	lastEdited?: string;
	contributors?: Array<any>;
	headerImage?: FileUpload;
	formatDate: (date: string) => string;
	getMonthsAgo: (date: string) => string;
}

const {
	title,
	doi = "10.36850/e1",
	issueNumber = "1",
	publicationDate,
	lastEdited,
	contributors = [],
	headerImage,
	formatDate,
	getMonthsAgo,
} = Astro.props;

const formattedPublicationDate = publicationDate ? formatDate(publicationDate) : "";
const formattedLastEdited = lastEdited ? getMonthsAgo(lastEdited) : "3 years ago";
const contributorText = contributors.length
	? contributors.map((c) => c.value || c.title || "Contributor").join(", ")
	: "Julie Leboeuf, Stine Linden-Andersen, and Jonathan Carriere";
---

<div
	class="relative overflow-hidden text-white min-h-[350px] sticky -top-[368px]"
	style="z-index: 1;"
>
	<!-- Background layers -->
	<div class="absolute inset-0 bg-white opacity-5"></div>
	<div
		class="absolute inset-0 bg-cover bg-center"
		style={`background-image: url('${headerImage?.[0]?.fileUploadUrl || ""}'); z-index: 1;`}
	>
	</div>
	<div class="absolute inset-0 bg-black bg-opacity-[0.0275] z-[2]"></div>
	<div class="absolute inset-0 bg-gradient-to-b from-black/10 to-black/40 z-[3]"></div>

	<!-- Content -->
	<div class="container mx-auto px-4 py-8 relative z-[4]">
		<!-- Top bar with issue number and metadata -->
		<div class="border-b border-white/20 pb-4">
			<div class="flex items-center">
				<button
					class="bg-white text-gray-800 px-3 py-1 rounded-md flex items-center text-sm mr-2"
				>
					<span class="mr-1">
						<svg data-icon="manual" width="14" height="14" viewBox="0 0 16 16">
							<path
								d="M15.99 1.13c-.02-.41-.33-.77-.78-.87C12.26-.36 9.84.13 8 1.7 6.16.13 3.74-.36.78.26.33.35.03.72.01 1.13H0v12c0 .08 0 .17.02.26.12.51.65.82 1.19.71 2.63-.55 4.59-.04 6.01 1.57.02.03.06.04.08.06.02.02.03.04.05.06.04.03.09.04.13.07.05.03.09.05.14.07.11.04.23.07.35.07h.04c.12 0 .24-.03.35-.07.05-.02.09-.05.14-.07.04-.02.09-.04.13-.07.02-.02.03-.04.05-.06.03-.02.06-.03.08-.06 1.42-1.6 3.39-2.12 6.01-1.57.54.11 1.07-.21 1.19-.71.04-.09.04-.18.04-.26l-.01-12zM7 12.99c-1.4-.83-3.07-1.14-5-.93V1.96c2.11-.28 3.75.2 5 1.46v9.57zm7-.92c-1.93-.21-3.6.1-5 .93V3.42c1.25-1.26 2.89-1.74 5-1.46v10.11z"
								fill-rule="evenodd"></path>
						</svg>
					</span>
					Issue {issueNumber}
					<span class="ml-1">
						<svg data-icon="caret-down" width="14" height="14" viewBox="0 0 16 16">
							<path
								d="M12 6.5c0-.28-.22-.5-.5-.5h-7a.495.495 0 00-.37.83l3.5 4c.09.1.22.17.37.17s.28-.07.37-.17l3.5-4c.08-.09.13-.2.13-.33z"
								fill-rule="evenodd"></path>
						</svg>
					</span>
				</button>
				<a href="#" class="text-white mr-4">Empirical</a>
				<button class="ml-2">
					<span class="text-white">
						<svg data-icon="plus" width="14" height="14" viewBox="0 0 16 16">
							<path
								d="M13 7H9V3c0-.55-.45-1-1-1s-1 .45-1 1v4H3c-.55 0-1 .45-1 1s.45 1 1 1h4v4c0 .55.45 1 1 1s1-.45 1-1V9h4c.55 0 1-.45 1-1s-.45-1-1-1z"
								fill-rule="evenodd"></path>
						</svg>
					</span>
				</button>
			</div>

			<div class="flex text-white mt-2">
				<span class="mr-4">
					<b class="text-white/70">Published on </b>{formattedPublicationDate}
				</span>
				<span>
					<b class="text-white/70">DOI </b>{doi}
				</span>
				<button class="ml-auto text-white px-2 py-1 rounded-md"> SHOW DETAILS </button>
			</div>
		</div>

		<!-- Title and author section -->
		<div class="mt-8 mb-6">
			<h1 class="text-4xl font-bold text-white mb-2">{title}</h1>
			<div class="text-white">
				<span>by {contributorText}</span>
			</div>
			<div class="text-white mt-2">
				<span class="text-white/70 mr-1">Published on</span>
				<span>{formattedPublicationDate}</span>
			</div>
		</div>

		<!-- Utility buttons -->
		<div class="flex flex-wrap mt-6">
			<a
				href="#"
				class="bg-white text-gray-800 px-3 py-2 rounded-md flex items-center text-sm mr-2 mb-2 hover:bg-gray-100"
			>
				<div class="mr-2">
					<svg data-icon="info-sign" width="14" height="14" viewBox="0 0 16 16">
						<path
							d="M8 0C3.58 0 0 3.58 0 8s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8zM7 3h2v2H7V3zm3 10H6v-1h1V7H6V6h3v6h1v1z"
							fill-rule="evenodd"></path>
					</svg>
				</div>
			</a>
			<a
				href="#"
				class="bg-white text-gray-800 px-3 py-2 rounded-md flex items-center text-sm mr-2 mb-2 hover:bg-gray-100"
			>
				<div class="mr-2">
					<svg data-icon="cog" width="14" height="14" viewBox="0 0 16 16">
						<path
							d="M15.19 6.39h-1.85c-.11-.37-.27-.71-.45-1.04l1.36-1.36c.31-.31.31-.82 0-1.13l-1.13-1.13a.803.803 0 00-1.13 0l-1.36 1.36c-.33-.17-.67-.33-1.04-.44V.79c0-.44-.36-.8-.8-.8h-1.6c-.44 0-.8.36-.8.8v1.86c-.39.12-.75.28-1.1.47l-1.3-1.3c-.3-.3-.79-.3-1.09 0L1.82 2.91c-.3.3-.3.79 0 1.09l1.3 1.3c-.2.34-.36.7-.48 1.09H.79c-.44 0-.8.36-.8.8v1.6c0 .44.36.8.8.8h1.85c.11.37.27.71.45 1.04l-1.36 1.36c-.31.31-.31.82 0 1.13l1.13 1.13c.31.31.82.31 1.13 0l1.36-1.36c.33.18.67.33 1.04.44v1.86c0 .44.36.8.8.8h1.6c.44 0 .8-.36.8-.8v-1.86c.39-.12.75-.28 1.1-.47l1.3 1.3c.3.3.79.3 1.09 0l1.09-1.09c.3-.3.3-.79 0-1.09l-1.3-1.3c.19-.35.36-.71.48-1.1h1.85c.44 0 .8-.36.8-.8v-1.6a.816.816 0 00-.81-.79zm-7.2 4.6c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3z"
							fill-rule="evenodd"></path>
					</svg>
				</div>
				<div>Pub settings</div>
			</a>
			<button
				class="bg-white text-gray-800 px-3 py-2 rounded-md flex items-center text-sm mr-2 mb-2 hover:bg-gray-100"
			>
				<div class="mr-2">
					<svg width="14" height="14" viewBox="0 0 24 24">
						<g>
							<path
								d="M5.56 22.286v-2.548h-2.039v-15.476h2.039v-2.548h-5.56v20.573h5.56zM24 22.286v-20.573h-5.583v2.548h2.039v15.476h-2.039v2.548h5.583z"
							></path>
							<path
								d="M13.918 5.993l-0.421 3.1h-2.409l0.438-3.1h-1.348l-0.421 3.1h-1.702v1.23h1.516l-0.404 2.982h-1.668v1.23h1.483l-0.438 3.083h1.331l0.438-3.083h2.393l-0.438 3.083h1.348l0.421-3.083h1.719v-1.23h-1.533l0.404-2.982h1.685v-1.23h-1.483l0.421-3.1h-1.331zM10.902 10.324h2.393l-0.388 2.982h-2.409l0.404-2.982z"
							></path>
						</g>
					</svg>
				</div>
				<div>Cite</div>
			</button>
			<button
				class="bg-white text-gray-800 px-3 py-2 rounded-md flex items-center text-sm mr-2 mb-2 hover:bg-gray-100"
			>
				<div class="mr-2">
					<svg width="14" height="14" viewBox="0 0 32 32">
						<path
							d="M25.524 22.54c-1.206 0-2.286 0.476-3.111 1.222l-11.317-6.587c0.079-0.365 0.143-0.73 0.143-1.111s-0.063-0.746-0.143-1.111l11.19-6.524c0.857 0.794 1.984 1.286 3.238 1.286 2.635 0 4.762-2.127 4.762-4.762s-2.127-4.762-4.762-4.762c-2.635 0-4.762 2.127-4.762 4.762 0 0.381 0.064 0.746 0.143 1.111l-11.191 6.524c-0.857-0.794-1.984-1.286-3.238-1.286-2.635 0-4.762 2.127-4.762 4.762s2.127 4.762 4.762 4.762c1.254 0 2.381-0.492 3.238-1.286l11.302 6.603c-0.079 0.333-0.127 0.683-0.127 1.032 0 2.556 2.079 4.635 4.635 4.635s4.635-2.079 4.635-4.635c0-2.556-2.079-4.635-4.635-4.635z"
						></path>
					</svg>
				</div>
				<div>Social</div>
			</button>
			<button
				class="bg-white text-gray-800 px-3 py-2 rounded-md flex items-center text-sm mr-2 mb-2 hover:bg-gray-100"
			>
				<div class="mr-2">
					<svg width="14" height="14" viewBox="0 0 32 32">
						<path
							d="M28.963 11.37h-7.407v-11.111h-11.111v11.111h-7.407l12.963 12.963 12.963-12.963zM3.037 28.037v3.704h25.926v-3.704h-25.926z"
						></path>
					</svg>
				</div>
				<div>Download</div>
			</button>
			<button
				class="bg-white text-gray-800 px-3 py-2 rounded-md flex items-center text-sm mr-2 mb-2 hover:bg-gray-100"
			>
				<div class="mr-2">
					<svg width="14" height="14" viewBox="0 0 24 24">
						<g>
							<path
								d="M17.077 19.582h-11.538v3.033h11.538v-3.033zM24 7.451h-18.462v3.033h18.462v-3.033zM5.538 16.55h18.462v-3.033h-18.462v3.033zM5.538 1.385v3.033h18.462v-3.033h-18.462z"
							></path>
							<path
								d="M2.769 2.769c0 0.765-0.62 1.385-1.385 1.385s-1.385-0.62-1.385-1.385c0-0.765 0.62-1.385 1.385-1.385s1.385 0.62 1.385 1.385z"
							></path>
						</g>
					</svg>
				</div>
				<div>Contents</div>
			</button>
		</div>

		<!-- Edit buttons -->
		<div class="flex mt-6 mb-4">
			<a
				href="#"
				class="bg-white text-gray-800 px-4 py-3 rounded-md flex items-center mr-4 hover:bg-gray-100"
			>
				<div class="mr-3">
					<svg data-icon="edit" width="22" height="22" viewBox="0 0 20 20">
						<path
							d="M4.59 12.59l2.83 2.83 7.65-7.65-2.83-2.83-7.65 7.65zM2 18l4.41-1.59-2.81-2.79L2 18zM16 2c-.55 0-1.05.22-1.41.59l-1.65 1.65 2.83 2.83 1.65-1.65A2.006 2.006 0 0016 2z"
							fill-rule="evenodd"></path>
					</svg>
				</div>
				<div>
					<div class="text-gray-600 text-xs">edit this Pub</div>
					<div class="font-medium">go to draft</div>
				</div>
			</a>
			<button
				class="bg-white text-gray-800 px-4 py-3 rounded-md flex items-center hover:bg-gray-100"
			>
				<div class="mr-3 flex items-center">
					<svg data-icon="history" width="22" height="22" viewBox="0 0 20 20">
						<path
							d="M10 0C6.71 0 3.82 1.6 2 4.05V2c0-.55-.45-1-1-1s-1 .45-1 1v4c0 .55.45 1 1 1h4c.55 0 1-.45 1-1s-.45-1-1-1H3.76C5.23 3.17 7.47 2 10 2c4.42 0 8 3.58 8 8s-3.58 8-8 8-8-3.58-8-8c0-.55-.45-1-1-1s-1 .45-1 1c0 5.52 4.48 10 10 10s10-4.48 10-10S15.52 0 10 0zm0 3c-.55 0-1 .45-1 1v6c0 .28.11.53.29.71l3 3a1.003 1.003 0 001.42-1.42L11 9.59V4c0-.55-.45-1-1-1z"
							fill-rule="evenodd"></path>
					</svg>
					<svg
						data-icon="caret-down"
						width="10"
						height="10"
						viewBox="0 0 16 16"
						class="ml-1"
					>
						<path
							d="M12 6.5c0-.28-.22-.5-.5-.5h-7a.495.495 0 00-.37.83l3.5 4c.09.1.22.17.37.17s.28-.07.37-.17l3.5-4c.08-.09.13-.2.13-.33z"
							fill-rule="evenodd"></path>
					</svg>
				</div>
				<div>
					<div class="text-gray-600 text-xs">last released</div>
					<div class="font-medium">{formattedLastEdited}</div>
				</div>
			</button>
		</div>
	</div>

	<!-- Sticky navigation header -->
	<div
		id="stickyHeader"
		class="fixed top-0 left-0 right-0 bg-white shadow-md py-2 px-4 flex justify-between items-center z-10 transform -translate-y-full transition-transform duration-300"
	>
		<div class="text-lg font-semibold truncate text-gray-800">{title}</div>
		<div class="flex items-center">
			<button class="text-gray-800 px-3 py-1 hover:bg-gray-100 rounded">Contents</button>
			<span class="mx-2 text-gray-400">·</span>
			<button class="text-gray-800 px-3 py-1 hover:bg-gray-100 rounded">
				<svg data-icon="double-chevron-up" width="16" height="16" viewBox="0 0 16 16">
					<path
						d="M4 8c.28 0 .53-.11.71-.29L8 4.41l3.29 3.29c.18.19.43.3.71.3a1.003 1.003 0 00.71-1.71l-4-4C8.53 2.11 8.28 2 8 2s-.53.11-.71.29l-4 4A1.003 1.003 0 004 8zm4.71-.71C8.53 7.11 8.28 7 8 7s-.53.11-.71.29l-4 4a1.003 1.003 0 001.42 1.42L8 9.41l3.29 3.29c.18.19.43.3.71.3a1.003 1.003 0 00.71-1.71l-4-4z"
						fill-rule="evenodd"></path>
				</svg>
			</button>
		</div>
	</div>
</div>

<script>
	// Add script to handle sticky header visibility
	document.addEventListener("DOMContentLoaded", () => {
		const header = document.querySelector(
			".relative.overflow-hidden.text-white"
		) as HTMLElement;
		const stickyHeader = document.getElementById("stickyHeader");

		if (header && stickyHeader) {
			window.addEventListener("scroll", () => {
				if (window.scrollY > header.offsetHeight - 100) {
					stickyHeader.classList.remove("-translate-y-full");
					stickyHeader.classList.add("translate-y-0");
				} else {
					stickyHeader.classList.remove("translate-y-0");
					stickyHeader.classList.add("-translate-y-full");
				}
			});
		}
	});
</script>
