1:"$Sreact.fragment"
3:I[99805,["/platform/pr-preview/pr-1389/_next/static/chunks/aeacce398bb52d2f.js","/platform/pr-preview/pr-1389/_next/static/chunks/688156694ad04c7c.js"],"default"]
4:I[26909,["/platform/pr-preview/pr-1389/_next/static/chunks/aeacce398bb52d2f.js","/platform/pr-preview/pr-1389/_next/static/chunks/688156694ad04c7c.js"],"default"]
6:I[2273,["/platform/pr-preview/pr-1389/_next/static/chunks/aeacce398bb52d2f.js","/platform/pr-preview/pr-1389/_next/static/chunks/688156694ad04c7c.js"],"OutletBoundary"]
7:"$Sreact.suspense"
9:I[2273,["/platform/pr-preview/pr-1389/_next/static/chunks/aeacce398bb52d2f.js","/platform/pr-preview/pr-1389/_next/static/chunks/688156694ad04c7c.js"],"ViewportBoundary"]
b:I[2273,["/platform/pr-preview/pr-1389/_next/static/chunks/aeacce398bb52d2f.js","/platform/pr-preview/pr-1389/_next/static/chunks/688156694ad04c7c.js"],"MetadataBoundary"]
d:I[49486,[],"default"]
:HL["/platform/pr-preview/pr-1389/_next/static/chunks/9da88c9be4528e23.css","style"]
0:{"P":null,"b":"853-8At4cu_57-1MKmUsw","c":["","development","getting-started"],"q":"","i":false,"f":[[["",{"children":[["mdxPath","development/getting-started","oc"],{"children":["__PAGE__",{}]}]},"$undefined","$undefined",true],[["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/platform/pr-preview/pr-1389/_next/static/chunks/9da88c9be4528e23.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}],["$","script","script-0",{"src":"/platform/pr-preview/pr-1389/_next/static/chunks/dd28ad6c648d3915.js","async":true,"nonce":"$undefined"}],["$","script","script-1",{"src":"/platform/pr-preview/pr-1389/_next/static/chunks/7c21ffbacf124703.js","async":true,"nonce":"$undefined"}],["$","script","script-2",{"src":"/platform/pr-preview/pr-1389/_next/static/chunks/40c2ac68a22f3b83.js","async":true,"nonce":"$undefined"}],["$","script","script-3",{"src":"/platform/pr-preview/pr-1389/_next/static/chunks/e2d6c8eabf052809.js","async":true,"nonce":"$undefined"}]],"$L2"]}],{"children":[["$","$1","c",{"children":[null,["$","$L3",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":[["$","$1","c",{"children":["$L5",null,["$","$L6",null,{"children":["$","$7",null,{"name":"Next.MetadataOutlet","children":"$@8"}]}]]}],{},null,false,false]},null,false,false]},null,false,false],["$","$1","h",{"children":[null,["$","$L9",null,{"children":"$@a"}],["$","div",null,{"hidden":true,"children":["$","$Lb",null,{"children":["$","$7",null,{"name":"Next.Metadata","children":"$@c"}]}]}],null]}],false]],"m":"$undefined","G":["$d",[]],"s":false,"S":true}
e:I[95217,["/platform/pr-preview/pr-1389/_next/static/chunks/dd28ad6c648d3915.js","/platform/pr-preview/pr-1389/_next/static/chunks/7c21ffbacf124703.js","/platform/pr-preview/pr-1389/_next/static/chunks/40c2ac68a22f3b83.js","/platform/pr-preview/pr-1389/_next/static/chunks/e2d6c8eabf052809.js"],"ThemeConfigProvider"]
f:I[541,["/platform/pr-preview/pr-1389/_next/static/chunks/dd28ad6c648d3915.js","/platform/pr-preview/pr-1389/_next/static/chunks/7c21ffbacf124703.js","/platform/pr-preview/pr-1389/_next/static/chunks/40c2ac68a22f3b83.js","/platform/pr-preview/pr-1389/_next/static/chunks/e2d6c8eabf052809.js"],"LastUpdated"]
10:I[55747,["/platform/pr-preview/pr-1389/_next/static/chunks/dd28ad6c648d3915.js","/platform/pr-preview/pr-1389/_next/static/chunks/7c21ffbacf124703.js","/platform/pr-preview/pr-1389/_next/static/chunks/40c2ac68a22f3b83.js","/platform/pr-preview/pr-1389/_next/static/chunks/e2d6c8eabf052809.js"],"Search"]
11:I[81795,["/platform/pr-preview/pr-1389/_next/static/chunks/dd28ad6c648d3915.js","/platform/pr-preview/pr-1389/_next/static/chunks/7c21ffbacf124703.js","/platform/pr-preview/pr-1389/_next/static/chunks/40c2ac68a22f3b83.js","/platform/pr-preview/pr-1389/_next/static/chunks/e2d6c8eabf052809.js"],"ThemeProvider"]
12:I[17614,["/platform/pr-preview/pr-1389/_next/static/chunks/dd28ad6c648d3915.js","/platform/pr-preview/pr-1389/_next/static/chunks/7c21ffbacf124703.js","/platform/pr-preview/pr-1389/_next/static/chunks/40c2ac68a22f3b83.js","/platform/pr-preview/pr-1389/_next/static/chunks/e2d6c8eabf052809.js"],"SkipNavLink"]
13:I[35907,["/platform/pr-preview/pr-1389/_next/static/chunks/dd28ad6c648d3915.js","/platform/pr-preview/pr-1389/_next/static/chunks/7c21ffbacf124703.js","/platform/pr-preview/pr-1389/_next/static/chunks/40c2ac68a22f3b83.js","/platform/pr-preview/pr-1389/_next/static/chunks/e2d6c8eabf052809.js"],"ConfigProvider"]
2:["$","html",null,{"lang":"en","dir":"ltr","suppressHydrationWarning":true,"children":[["$","head",null,{"children":["$undefined",["$","style",null,{"children":":root {\n  --nextra-primary-hue: 212deg;\n  --nextra-primary-saturation: 100%;\n  --nextra-primary-lightness: 45%;\n  --nextra-bg: 250,250,250;\n  --nextra-content-width: 90rem;\n}\n.dark {\n  --nextra-primary-hue: 204deg;\n  --nextra-primary-saturation: 100%;\n  --nextra-primary-lightness: 55%;\n  --nextra-bg: 17,17,17;\n}\n::selection {\n  background: hsla(var(--nextra-primary-hue),var(--nextra-primary-saturation),var(--nextra-primary-lightness),.3);\n}\nhtml {\n  background: rgb(var(--nextra-bg));\n}"}],["$","meta",null,{"name":"theme-color","media":"(prefers-color-scheme: light)","content":"rgb(250,250,250)"}],["$","meta",null,{"name":"theme-color","media":"(prefers-color-scheme: dark)","content":"rgb(17,17,17)"}],"$undefined"]}],["$","body",null,{"children":["$","$Le",null,{"value":{"children":"$undefined","copyPageButton":true,"darkMode":true,"docsRepositoryBase":"https://github.com/pubpub/platform/tree/main/docs","editLink":"Edit this page","feedback":{"content":"Question? Give us feedback","labels":"feedback"},"i18n":[],"lastUpdated":["$","$Lf",null,{}],"navigation":{"next":true,"prev":true},"search":["$","$L10",null,{}],"sidebar":{"defaultMenuCollapseLevel":2,"defaultOpen":true,"toggleButton":true},"themeSwitch":{"dark":"Dark","light":"Light","system":"System"},"toc":{"backToTop":"Scroll to top","float":true,"title":"On This Page"}},"children":["$","$L11",null,{"attribute":"class","defaultTheme":"system","disableTransitionOnChange":true,"storageKey":"theme","children":[["$","$L12",null,{}],"$undefined",["$","$L13",null,{"pageMap":[{"data":{"infrastructure":{"title":"üèóÔ∏è Infrastructure"},"development":{"title":"üë©‚Äçüíª Development"}}},{"name":"index","route":"/","frontMatter":{"title":"Introduction","filePath":"content/index.mdx","timestamp":1759937674000},"title":"Introduction"},{"name":"infrastructure","route":"/infrastructure","children":[{"name":"ecs-cluster","route":"/infrastructure/ecs-cluster","frontMatter":{"title":"Terraform","filePath":"content/infrastructure/ecs-cluster.mdx","timestamp":1753282322000},"title":"Terraform"},{"name":"environments","route":"/infrastructure/environments","children":[{"name":"cloudflare","route":"/infrastructure/environments/cloudflare","frontMatter":{"title":"Global Cloudflare configuration","filePath":"content/infrastructure/environments/cloudflare.mdx","timestamp":1750086553000},"title":"Global Cloudflare configuration"},{"name":"global-aws","route":"/infrastructure/environments/global-aws","frontMatter":{"title":"Global AWS configurations","filePath":"content/infrastructure/environments/global-aws.mdx","timestamp":1750086553000},"title":"Global AWS configurations"}],"title":"Environments"},{"name":"modules","route":"/infrastructure/modules","children":[{"name":"core-services","route":"/infrastructure/modules/core-services","frontMatter":{"title":"Core Services","filePath":"content/infrastructure/modules/core-services.mdx","timestamp":1759937674000},"title":"Core Services"}],"title":"Modules"},{"name":"nginx","route":"/infrastructure/nginx","frontMatter":{"title":"Nginx","filePath":"content/infrastructure/nginx.mdx","timestamp":1759937674000},"title":"Nginx"}],"frontMatter":{"title":"Infrastructure","description":"Information about the infrastructure that runs PubPub.","sidebarTitle":"üèóÔ∏è Infrastructure","asIndexPage":true,"filePath":"content/infrastructure/index.mdx","timestamp":1750086553000},"title":"üèóÔ∏è Infrastructure"},{"name":"development","route":"/development","children":[{"data":{"getting-started":{},"common-issues":{},"concepts":{},"database":{},"testing":{"title":"üß™ Testing"}}},{"name":"getting-started","route":"/development/getting-started","frontMatter":{"title":"Getting started","filePath":"content/development/getting-started.mdx","timestamp":1741355665000},"title":"Getting started"},{"name":"common-issues","route":"/development/common-issues","frontMatter":{"title":"Issues you may run into","filePath":"content/development/common-issues.mdx","timestamp":1759937674000},"title":"Issues you may run into"},{"name":"concepts","route":"/development/concepts","children":[{"name":"authorization","route":"/development/concepts/authorization","frontMatter":{"title":"Capabilities","filePath":"content/development/concepts/authorization.mdx","timestamp":1753282322000},"title":"Capabilities"},{"name":"invites","route":"/development/concepts/invites","frontMatter":{"title":"Invites","filePath":"content/development/concepts/invites.mdx","timestamp":1750086553000},"title":"Invites"},{"name":"richtext","route":"/development/concepts/richtext","frontMatter":{"title":"Rich Text Fields","filePath":"content/development/concepts/richtext.mdx","timestamp":1759937674000},"title":"Rich Text Fields"},{"name":"serverActions","route":"/development/concepts/serverActions","frontMatter":{"title":"Server Actions","filePath":"content/development/concepts/serverActions.mdx","timestamp":1741355665000},"title":"Server Actions"}],"title":"Concepts"},{"name":"database","route":"/development/database","children":[{"name":"1-prisma","route":"/development/database/1-prisma","frontMatter":{"title":"Prisma (migrations)","filePath":"content/development/database/1-prisma.mdx","timestamp":1759937674000},"title":"Prisma (migrations)"},{"name":"2-kanel-type-generation","route":"/development/database/2-kanel-type-generation","frontMatter":{"title":"Kanel (type generation)","filePath":"content/development/database/2-kanel-type-generation.mdx","timestamp":1750086553000},"title":"Kanel (type generation)"},{"name":"3-kysely","route":"/development/database/3-kysely","frontMatter":{"title":"Kysely (query builder)","filePath":"content/development/database/3-kysely.mdx","timestamp":1759937674000},"title":"Kysely (query builder)"},{"name":"4-caching","route":"/development/database/4-caching","frontMatter":{"title":"Caching","filePath":"content/development/database/4-caching.mdx","timestamp":1759937674000},"title":"Caching"}],"frontMatter":{"title":"Database","description":"How we manage our database","sidebarTitle":"üíæ Database","asIndexPage":true,"filePath":"content/development/database/index.mdx","timestamp":1759937674000},"title":"üíæ Database"},{"name":"testing","route":"/development/testing","children":[{"name":"1-e2e-tests","route":"/development/testing/1-e2e-tests","frontMatter":{"title":"E2E Tests","filePath":"content/development/testing/1-e2e-tests.mdx","timestamp":1759937674000},"title":"E2E Tests"},{"name":"2-load-testing","route":"/development/testing/2-load-testing","frontMatter":{"title":"Load Testing","filePath":"content/development/testing/2-load-testing.mdx","timestamp":1750086553000},"title":"Load Testing"},{"name":"3-TODO-vitest","route":"/development/testing/3-TODO-vitest","frontMatter":{"title":"TODO: Add docs for how to run vitest tests","filePath":"content/development/testing/3-TODO-vitest.mdx","timestamp":1759937674000},"title":"TODO: Add docs for how to run vitest tests"}],"title":"üß™ Testing"}],"title":"üë©‚Äçüíª Development"}],"navbar":"$L14","footer":"$L15","children":["$L16","$L17"]}]]}]}]}]]}]
18:I[14325,["/platform/pr-preview/pr-1389/_next/static/chunks/dd28ad6c648d3915.js","/platform/pr-preview/pr-1389/_next/static/chunks/7c21ffbacf124703.js","/platform/pr-preview/pr-1389/_next/static/chunks/40c2ac68a22f3b83.js","/platform/pr-preview/pr-1389/_next/static/chunks/e2d6c8eabf052809.js"],""]
19:I[36817,["/platform/pr-preview/pr-1389/_next/static/chunks/dd28ad6c648d3915.js","/platform/pr-preview/pr-1389/_next/static/chunks/7c21ffbacf124703.js","/platform/pr-preview/pr-1389/_next/static/chunks/40c2ac68a22f3b83.js","/platform/pr-preview/pr-1389/_next/static/chunks/e2d6c8eabf052809.js"],"ClientNavbar"]
1b:I[92479,["/platform/pr-preview/pr-1389/_next/static/chunks/dd28ad6c648d3915.js","/platform/pr-preview/pr-1389/_next/static/chunks/7c21ffbacf124703.js","/platform/pr-preview/pr-1389/_next/static/chunks/40c2ac68a22f3b83.js","/platform/pr-preview/pr-1389/_next/static/chunks/e2d6c8eabf052809.js"],"Switchers"]
1c:I[65981,["/platform/pr-preview/pr-1389/_next/static/chunks/dd28ad6c648d3915.js","/platform/pr-preview/pr-1389/_next/static/chunks/7c21ffbacf124703.js","/platform/pr-preview/pr-1389/_next/static/chunks/40c2ac68a22f3b83.js","/platform/pr-preview/pr-1389/_next/static/chunks/e2d6c8eabf052809.js"],"LocaleSwitch"]
1d:I[94230,["/platform/pr-preview/pr-1389/_next/static/chunks/dd28ad6c648d3915.js","/platform/pr-preview/pr-1389/_next/static/chunks/7c21ffbacf124703.js","/platform/pr-preview/pr-1389/_next/static/chunks/40c2ac68a22f3b83.js","/platform/pr-preview/pr-1389/_next/static/chunks/e2d6c8eabf052809.js"],"ThemeSwitch"]
1e:I[99951,["/platform/pr-preview/pr-1389/_next/static/chunks/dd28ad6c648d3915.js","/platform/pr-preview/pr-1389/_next/static/chunks/7c21ffbacf124703.js","/platform/pr-preview/pr-1389/_next/static/chunks/40c2ac68a22f3b83.js","/platform/pr-preview/pr-1389/_next/static/chunks/e2d6c8eabf052809.js"],"MobileNav"]
:HL["/platform/pr-preview/pr-1389/logo.svg","image"]
1a:T481,M12 3C7.0275 3 3 7.12937 3 12.2276C3 16.3109 5.57625 19.7597 9.15374 20.9824C9.60374 21.0631 9.77249 20.7863 9.77249 20.5441C9.77249 20.3249 9.76125 19.5982 9.76125 18.8254C7.5 19.2522 6.915 18.2602 6.735 17.7412C6.63375 17.4759 6.19499 16.6569 5.8125 16.4378C5.4975 16.2647 5.0475 15.838 5.80124 15.8264C6.51 15.8149 7.01625 16.4954 7.18499 16.7723C7.99499 18.1679 9.28875 17.7758 9.80625 17.5335C9.885 16.9337 10.1212 16.53 10.38 16.2993C8.3775 16.0687 6.285 15.2728 6.285 11.7432C6.285 10.7397 6.63375 9.9092 7.20749 9.26326C7.1175 9.03257 6.8025 8.08674 7.2975 6.81794C7.2975 6.81794 8.05125 6.57571 9.77249 7.76377C10.4925 7.55615 11.2575 7.45234 12.0225 7.45234C12.7875 7.45234 13.5525 7.55615 14.2725 7.76377C15.9937 6.56418 16.7475 6.81794 16.7475 6.81794C17.2424 8.08674 16.9275 9.03257 16.8375 9.26326C17.4113 9.9092 17.76 10.7281 17.76 11.7432C17.76 15.2843 15.6563 16.0687 13.6537 16.2993C13.98 16.5877 14.2613 17.1414 14.2613 18.0065C14.2613 19.2407 14.25 20.2326 14.25 20.5441C14.25 20.7863 14.4188 21.0746 14.8688 20.9824C16.6554 20.364 18.2079 19.1866 19.3078 17.6162C20.4077 16.0457 20.9995 14.1611 21 12.2276C21 7.12937 16.9725 3 12 3Z14:["$","header",null,{"className":"nextra-navbar x:sticky x:top-0 x:z-30 x:w-full x:bg-transparent x:print:hidden x:max-md:[.nextra-banner:not([class$=hidden])~&]:top-(--nextra-banner-height)","children":[["$","div",null,{"className":"nextra-navbar-blur x:absolute x:-z-1 x:size-full nextra-border x:border-b x:backdrop-blur-md x:bg-nextra-bg/70"}],["$","nav",null,{"style":{"height":"var(--nextra-navbar-height)"},"className":"x:mx-auto x:flex x:max-w-(--nextra-content-width) x:items-center x:gap-4 x:pl-[max(env(safe-area-inset-left),1.5rem)] x:pr-[max(env(safe-area-inset-right),1.5rem)] x:justify-end","children":[["$","$L18",null,{"href":"/platform/pr-preview/pr-1389/","className":"x:flex x:items-center x:me-auto x:transition-opacity x:focus-visible:nextra-focus x:hover:opacity-75","aria-label":"Home page","children":["$","div",null,{"className":"flex items-center","children":[["$","img",null,{"src":"/platform/pr-preview/pr-1389/logo.svg","alt":"PubPub","height":"20","width":"20"}],["$","span",null,{"className":"ml-2 font-semibold","children":"PubPub Development Docs"}]]}]}],["$","$L19",null,{"className":"","children":[["$","a",null,{"href":"https://github.com/pubpub/platform","target":"_blank","rel":"noreferrer","children":[["$","svg",null,{"fill":"currentColor","viewBox":"3 3 18 18","height":"24","aria-label":"Project repository","children":["$","path",null,{"d":"$1a"}]}],false],"className":"x:focus-visible:nextra-focus"}],"$undefined","$undefined"]}]]}]]}]
15:["$","div",null,{"className":"x:bg-gray-100 x:pb-[env(safe-area-inset-bottom)] x:dark:bg-neutral-900 x:print:bg-transparent","children":[["$","$L1b",null,{"children":["$","div",null,{"className":"x:mx-auto x:flex x:max-w-(--nextra-content-width) x:gap-2 x:py-2 x:px-4","children":[["$","$L1c",null,{}],["$","$L1d",null,{}]]}]}],["$","hr",null,{"className":"nextra-border"}],["$","footer",null,{"className":"x:mx-auto x:flex x:max-w-(--nextra-content-width) x:justify-center x:py-12 x:text-gray-600 x:dark:text-gray-400 x:md:justify-start x:pl-[max(env(safe-area-inset-left),1.5rem)] x:pr-[max(env(safe-area-inset-right),1.5rem)]","children":["MIT ",2025," ¬© Knowledge Futures Inc."]}]]}]
16:["$","$L1e",null,{}]
17:["$","$L3",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]
1f:I[74508,["/platform/pr-preview/pr-1389/_next/static/chunks/dd28ad6c648d3915.js","/platform/pr-preview/pr-1389/_next/static/chunks/7c21ffbacf124703.js","/platform/pr-preview/pr-1389/_next/static/chunks/40c2ac68a22f3b83.js","/platform/pr-preview/pr-1389/_next/static/chunks/e2d6c8eabf052809.js"],"TOCProvider"]
20:I[99951,["/platform/pr-preview/pr-1389/_next/static/chunks/dd28ad6c648d3915.js","/platform/pr-preview/pr-1389/_next/static/chunks/7c21ffbacf124703.js","/platform/pr-preview/pr-1389/_next/static/chunks/40c2ac68a22f3b83.js","/platform/pr-preview/pr-1389/_next/static/chunks/e2d6c8eabf052809.js"],"Sidebar"]
21:I[87765,["/platform/pr-preview/pr-1389/_next/static/chunks/dd28ad6c648d3915.js","/platform/pr-preview/pr-1389/_next/static/chunks/7c21ffbacf124703.js","/platform/pr-preview/pr-1389/_next/static/chunks/40c2ac68a22f3b83.js","/platform/pr-preview/pr-1389/_next/static/chunks/e2d6c8eabf052809.js"],"ClientWrapper"]
22:T1e89,# Getting started

## Local Development

To run all packages in the monorepo workspace, simply run:

```sh
pnpm dev:setup
pnpm dev
```

Often, you'll only want to run a specific package's dev script. In that case, use pnpm [filters](https://pnpm.io/filtering):

```sh
pnpm dev --filter core    // Runs just the `core` packages dev script
pnpm dev --filter core... // Runs just the `core` package and its dependencies dev scripts
```

Note that the term following `--filter` is the name of the package as specified in `package.json`, not the folder name (even though those may sometimes be identical).

You can also use [filters](https://pnpm.io/filtering) to run package-specific commands, by placing the `--filter` flag before the script name:

```sh
pnpm --filter core reset
pnpm --filter core migrate-dev
```

## Docker Compose

Docker-compose provides a means to run all the code components as containers. It has these advantages:

- more realistically emulating the setting where this code is run in production.
- less contamination of environment, so spurious failures (or successes) can be avoided.
- easy to boot from nothing without system dependencies except Docker

With disadvantages:

- doesn't support hot-reloading
- slightly slower iteration due to `docker build` between runs

With these properties, this is useful for end-to-end tests and locally verifying that the code works when removed from some of the fast-iteration features of `next.js`, such as
JIT compilation. Because a `docker build` is needed to build the containers to run, hot-reloading is not available in this environment; so faster iteration
with `pnpm dev` is recommended until you are ready to run battery of tests or need to verify behavior in an isolated environment.

A slightly modified version of `.env.local` is required, where we remove the DATABASE_URL (this is built out of parts in docker envs):

```sh
grep -v DATABASE_URL \
    <./core/.env.local \
    >./.env.docker-compose
```

This cluster will address the local supabase and postgres just like when you are running with `pnpm dev`, so no need to take extra steps for migrations (though the same ones are needed).

To run the full cluster as local docker-compose, first initialize supabase as you would for development; then do:

```
docker compose -f docker-compose.dev.yml up
```

you can now address on `localhost:3000` as before. note that `pnpm dev` uses the same ports and cannot be running at the same time.

## Prettier

At the moment, the repo simply uses prettier before adding any additional complexity with ESLint configs. Just auto-format (either on save, or on commit), and let the .prettierrc hold the small subset of decisions.

For a nicer DX, bind `Format Document` to a familiar keyboard shortcut so you can format the doc as you go (similar to format-on-save and then saving frequently).

## Git Hooks

Two hooks are defined using `husky` and stored in `.husky`.

- The first runs Prettier on commit
- The second runs a type-check before pushing. Since our deployment setup builds on each push, the intent here is to not trigger a build with known type errors.

Sometimes you want to push up changes even though there is a type error. To do so, include `--no-verify` at the end of your command. For example: `git push origin main --no-verify`.

## Turborepo race conditions

We currently have a race condition where dev will sometimes fail because we can't specify the order of dependency builds. Tied to the fact that we clean out the dist folder on build, but upstream packages are watching dist.

- https://github.com/vercel/turbo/discussions/1299?sort=top?sort=top
- https://github.com/vercel/turbo/issues/460

`core` depends on `ui` which depends on `utils`. `utils` often takes longer to build than it does for `ui` to start building, which causes an error to be thrown because `utils` d.ts file has been cleared out during its build and hasn't been replaced yet. This generates an error, but is quick to resolve, so doesn't break actual dev work from beginning. It does make the console output messier though.

## Building and deploying for AWS environments

All change management to Knowledge Futures' production environment is done through github actions.
This environment runs on AWS ECS and leverages terraform to allow reproducible, parametric environments.

Services running in AWS ECS are scheduled using "Task Definitions", which are CRUDdy resources
including all details for a container. We don't want to tie code releases to terraform "infrastructure" changes,
but the service "declaration" relies on this Task Definition to exist.

Therefore based on community patterns we have seen, the flow is roughly this:

1. The infrastructure code in terraform declares a "template" Task Definition.
2. Terraform is told not to change the "service" based on changes to the Task Definition.
3. Any changes to the template will be picked up by the next deploy, which is done outside of Terraform.
4. Github Actions builds new containers on merge, and will use AWS-provided Actions to template the literal correct Task Definition and update the Service.

### Updating deployment topology and/or environment variables/container settings

To change "infrastructure settings", which include anything from networking to env vars,
make changes to `./infrastructure/terraform/aws`. Use `terraform apply` there to update
the infrastructure and/or Task Definition Template. See that directory for more info.

Then you must perform a Github Actions Deploy, either by pushing your changes to main or
with local `act` CLI.

### Updating container versions with github actions

The core automation workflow can be examined in [`awsdeploy.yml`](./.github/workflows/awsdeploy.yml)

There is a Dockerfile in this repository that builds a container for one package. You can use it like:

```sh
docker build \
            --platform linux/amd64 \
            --build-arg PACKAGE=core \
            --build-arg PACKAGE_DIR=core \
            -t $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG \
            .
```

Note how this matches the invocation used in the Actions workflow file.

We automatically build and push a container to AWS ECR with the github SHA as a tag.

### Using `act` to run the deploy events locally

If you need to build or validate a change and deploy to production, you can use the [`act` cli](https://github.com/nektos/act):

```sh
act \
    -W .github/workflows/awsdeploy.yml \
    --container-architecture linux/amd64 \
    --secret-file ~/.aws/pubpub.secrets \
    -j deploy
```

**AWS CLI access in `act`:**
When you setup `act` locally for the first time, you can choose whether to do a Small, Medium, or Large install.
The Large install is _very large_, but the medium install does not include the AWS CLI.

If you choose to work with the medium install, you will need to customize afterward by editing your `~/.actrc` file
to use an image that includes the AWS CLI, for example your .actrc might look like:

```filename=.actrc
-P ubuntu-latest=eveships/act-plusplus:latest
-P ubuntu-22.04=catthehacker/ubuntu:full-22.04
-P ubuntu-20.04=catthehacker/ubuntu:full-20.04
-P ubuntu-18.04=catthehacker/ubuntu:full-18.04
```

**Secrets:** Though you will have an `~/.aws/credentials` file, this is not the format for secrets access that
`act` requires, so I copy the key-value pairs in that file into a file that matches the Github
secrets called `~/.aws/pubpub.secrets`:

```
AWS_ACCESS_KEY_ID=...
AWS_SECRET_ACCESS_KEY...
```

**Dirty worktree:** If you run `act` like this, the image will be conveniently tagged with the latest SHA plus `-dirty`.
Images tagged with a SHA alone should be idempotently built, but `-dirty` can be changed/overwritten.

**TODO:**

- [ ] allow deploying without a rebuild, so that a rollback is convenient5:["$","div",null,{"className":"x:mx-auto x:flex x:max-w-(--nextra-content-width)","children":["$","$L1f",null,{"value":[{"value":"Local Development","id":"local-development","depth":2},{"value":"Docker Compose","id":"docker-compose","depth":2},{"value":"Prettier","id":"prettier","depth":2},{"value":"Git Hooks","id":"git-hooks","depth":2},{"value":"Turborepo race conditions","id":"turborepo-race-conditions","depth":2},{"value":"Building and deploying for AWS environments","id":"building-and-deploying-for-aws-environments","depth":2},{"value":"Updating deployment topology and/or environment variables/container settings","id":"updating-deployment-topology-andor-environment-variablescontainer-settings","depth":3},{"value":"Updating container versions with github actions","id":"updating-container-versions-with-github-actions","depth":3},{"value":[["$","$1",".0",{"children":["Using ",["$","code",".1",{"className":"nextra-code","dir":"ltr","children":"act"}]," to run the deploy events locally"]}]],"id":"using-act-to-run-the-deploy-events-locally","depth":3}],"children":[["$","$L20",null,{}],["$","$L21",null,{"metadata":"$2:props:children:1:props:children:props:children:props:children:2:props:pageMap:3:children:1:frontMatter","bottomContent":"$undefined","sourceCode":"$22","children":["$L23","$L24"]}]]}]}]
25:I[22915,["/platform/pr-preview/pr-1389/_next/static/chunks/dd28ad6c648d3915.js","/platform/pr-preview/pr-1389/_next/static/chunks/7c21ffbacf124703.js","/platform/pr-preview/pr-1389/_next/static/chunks/40c2ac68a22f3b83.js","/platform/pr-preview/pr-1389/_next/static/chunks/e2d6c8eabf052809.js"],"HeadingAnchor"]
26:I[68093,["/platform/pr-preview/pr-1389/_next/static/chunks/dd28ad6c648d3915.js","/platform/pr-preview/pr-1389/_next/static/chunks/7c21ffbacf124703.js","/platform/pr-preview/pr-1389/_next/static/chunks/40c2ac68a22f3b83.js","/platform/pr-preview/pr-1389/_next/static/chunks/e2d6c8eabf052809.js"],"ToggleWordWrapButton"]
23:["$","div",null,{"id":"nextra-skip-nav"}]
24:["$","main",null,{"data-pagefind-body":true,"children":[["$","h1",null,{"id":"$undefined","className":"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-bold x:mt-2 x:text-4xl","children":["Getting started","$undefined"]}],"\n",["$","h2",null,{"id":"local-development","className":"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border","children":["Local Development",["$","$L25",null,{"id":"local-development"}]]}],"\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":"To run all packages in the monorepo workspace, simply run:"}],"\n",["$","div",null,{"data-pagefind-ignore":"$undefined","className":"nextra-code x:relative x:not-first:mt-[1.25em]","children":["$undefined",["$","pre",null,{"className":"x:group x:focus-visible:nextra-focus x:overflow-x-auto x:subpixel-antialiased x:text-[.9em] x:bg-white x:dark:bg-black x:py-4 x:ring-1 x:ring-inset x:ring-gray-300 x:dark:ring-neutral-700 x:contrast-more:ring-gray-900 x:contrast-more:dark:ring-gray-50 x:contrast-more:contrast-150 x:rounded-md not-prose","tabIndex":"0","children":[["$","div",null,{"className":"x:group-hover:opacity-100 x:group-focus:opacity-100 x:opacity-0 x:transition x:focus-within:opacity-100 x:flex x:gap-1 x:absolute x:right-4 x:top-2","children":[["$","$L26",null,{"children":["$","svg",null,{"viewBox":"0 0 24 24","fill":"currentColor","height":"1em","children":["$","path",null,{"d":"M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"}]}]}],false]}],["$","code",null,{"className":"nextra-code","dir":"ltr","children":[["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},"children":"pnpm"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" dev:setup"}]]}],"\n",["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},"children":"pnpm"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" dev"}]]}]]}]]}]]}],"\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["Often, you‚Äôll only want to run a specific package‚Äôs dev script. In that case, use pnpm ",["$","a",null,{"href":"https://pnpm.io/filtering","target":"_blank","rel":"noreferrer","className":"x:focus-visible:nextra-focus x:text-primary-600 x:underline x:hover:no-underline x:decoration-from-font x:[text-underline-position:from-font]","children":["filters",["¬†",["$","svg",null,{"fill":"none","stroke":"currentColor","strokeLinecap":"round","strokeLinejoin":"round","strokeWidth":1.7,"viewBox":"0 0 24 24","height":"1em","className":"x:inline x:align-baseline x:shrink-0","children":[["$","path",null,{"d":"M7 17L17 7"}],["$","path",null,{"d":"M7 7h10v10"}]]}]]]}],":"]}],"\n",["$","div",null,{"data-pagefind-ignore":"$undefined","className":"nextra-code x:relative x:not-first:mt-[1.25em]","children":["$undefined",["$","pre",null,{"className":"x:group x:focus-visible:nextra-focus x:overflow-x-auto x:subpixel-antialiased x:text-[.9em] x:bg-white x:dark:bg-black x:py-4 x:ring-1 x:ring-inset x:ring-gray-300 x:dark:ring-neutral-700 x:contrast-more:ring-gray-900 x:contrast-more:dark:ring-gray-50 x:contrast-more:contrast-150 x:rounded-md not-prose","tabIndex":"0","children":[["$","div",null,{"className":"x:group-hover:opacity-100 x:group-focus:opacity-100 x:opacity-0 x:transition x:focus-within:opacity-100 x:flex x:gap-1 x:absolute x:right-4 x:top-2","children":[["$","$L26",null,{"children":["$","svg",null,{"viewBox":"0 0 24 24","fill":"currentColor","height":"1em","children":["$","path",null,{"d":"M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"}]}]}],false]}],["$","code",null,{"className":"nextra-code","dir":"ltr","children":[["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},"children":"pnpm"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" dev"}],"$L27","$L28","$L29","$L2a","$L2b","$L2c","$L2d","$L2e","$L2f","$L30","$L31","$L32"]}],"\n","$L33"]}]]}]]}],"\n","$L34","\n","$L35","\n","$L36","\n","$L37","\n","$L38","\n","$L39","\n","$L3a","\n","$L3b","\n","$L3c","\n","$L3d","\n","$L3e","\n","$L3f","\n","$L40","\n","$L41","\n","$L42","\n","$L43","\n","$L44","\n","$L45","\n","$L46","\n","$L47","\n","$L48","\n","$L49","\n","$L4a","\n","$L4b","\n","$L4c","\n","$L4d","\n","$L4e","\n","$L4f","\n","$L50","\n","$L51","\n","$L52","\n","$L53","\n","$L54","\n","$L55","\n","$L56","\n","$L57","\n","$L58","\n","$L59","\n","$L5a","\n","$L5b","\n","$L5c","\n","$L5d","\n","$L5e","\n","$L5f","\n","$L60","\n","$L61","\n","$L62","\n","$L63","\n","$L64","\n","$L65","\n","$L66"]}]
27:["$","span",null,{"style":{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},"children":" --filter"}]
28:["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" core"}]
29:["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":"    //"}]
2a:["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" Runs"}]
2b:["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" just"}]
2c:["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" the"}]
2d:["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" `"}]
2e:["$","span",null,{"style":{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},"children":"core"}]
2f:["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":"`"}]
30:["$","span",null,{"style":{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},"children":" packages"}]
31:["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" dev"}]
32:["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" script"}]
33:["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},"children":"pnpm"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" dev"}],["$","span",null,{"style":{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},"children":" --filter"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" core..."}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" //"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" Runs"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" just"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" the"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" `"}],["$","span",null,{"style":{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},"children":"core"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":"`"}],["$","span",null,{"style":{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},"children":" package"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" and"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" its"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" dependencies"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" dev"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" scripts"}]]}]
34:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["Note that the term following ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"--filter"}]," is the name of the package as specified in ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"package.json"}],", not the folder name (even though those may sometimes be identical)."]}]
35:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["You can also use ",["$","a",null,{"href":"https://pnpm.io/filtering","target":"_blank","rel":"noreferrer","className":"x:focus-visible:nextra-focus x:text-primary-600 x:underline x:hover:no-underline x:decoration-from-font x:[text-underline-position:from-font]","children":["filters",["¬†",["$","svg",null,{"fill":"none","stroke":"currentColor","strokeLinecap":"round","strokeLinejoin":"round","strokeWidth":1.7,"viewBox":"0 0 24 24","height":"1em","className":"x:inline x:align-baseline x:shrink-0","children":[["$","path",null,{"d":"M7 17L17 7"}],["$","path",null,{"d":"M7 7h10v10"}]]}]]]}]," to run package-specific commands, by placing the ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"--filter"}]," flag before the script name:"]}]
36:["$","div",null,{"data-pagefind-ignore":"$undefined","className":"nextra-code x:relative x:not-first:mt-[1.25em]","children":["$undefined",["$","pre",null,{"className":"x:group x:focus-visible:nextra-focus x:overflow-x-auto x:subpixel-antialiased x:text-[.9em] x:bg-white x:dark:bg-black x:py-4 x:ring-1 x:ring-inset x:ring-gray-300 x:dark:ring-neutral-700 x:contrast-more:ring-gray-900 x:contrast-more:dark:ring-gray-50 x:contrast-more:contrast-150 x:rounded-md not-prose","tabIndex":"0","children":[["$","div",null,{"className":"x:group-hover:opacity-100 x:group-focus:opacity-100 x:opacity-0 x:transition x:focus-within:opacity-100 x:flex x:gap-1 x:absolute x:right-4 x:top-2","children":[["$","$L26",null,{"children":["$","svg",null,{"viewBox":"0 0 24 24","fill":"currentColor","height":"1em","children":["$","path",null,{"d":"M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"}]}]}],false]}],["$","code",null,{"className":"nextra-code","dir":"ltr","children":[["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},"children":"pnpm"}],["$","span",null,{"style":{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},"children":" --filter"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" core"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" reset"}]]}],"\n",["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},"children":"pnpm"}],["$","span",null,{"style":{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},"children":" --filter"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" core"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" migrate-dev"}]]}]]}]]}]]}]
37:["$","h2",null,{"id":"docker-compose","className":"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border","children":["Docker Compose",["$","$L25",null,{"id":"docker-compose"}]]}]
38:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":"Docker-compose provides a means to run all the code components as containers. It has these advantages:"}]
39:["$","ul",null,{"className":"x:[:is(ol,ul)_&]:my-[.75em] x:not-first:mt-[1.25em] x:list-disc x:ms-[1.5em]","children":["\n",["$","li",null,{"className":"x:my-[.5em]","children":"more realistically emulating the setting where this code is run in production."}],"\n",["$","li",null,{"className":"x:my-[.5em]","children":"less contamination of environment, so spurious failures (or successes) can be avoided."}],"\n",["$","li",null,{"className":"x:my-[.5em]","children":"easy to boot from nothing without system dependencies except Docker"}],"\n"]}]
3a:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":"With disadvantages:"}]
3b:["$","ul",null,{"className":"x:[:is(ol,ul)_&]:my-[.75em] x:not-first:mt-[1.25em] x:list-disc x:ms-[1.5em]","children":["\n",["$","li",null,{"className":"x:my-[.5em]","children":"doesn‚Äôt support hot-reloading"}],"\n",["$","li",null,{"className":"x:my-[.5em]","children":["slightly slower iteration due to ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"docker build"}]," between runs"]}],"\n"]}]
3c:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["With these properties, this is useful for end-to-end tests and locally verifying that the code works when removed from some of the fast-iteration features of ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"next.js"}],", such as\nJIT compilation. Because a ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"docker build"}]," is needed to build the containers to run, hot-reloading is not available in this environment; so faster iteration\nwith ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"pnpm dev"}]," is recommended until you are ready to run battery of tests or need to verify behavior in an isolated environment."]}]
3d:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["A slightly modified version of ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":".env.local"}]," is required, where we remove the DATABASE_URL (this is built out of parts in docker envs):"]}]
3e:["$","div",null,{"data-pagefind-ignore":"$undefined","className":"nextra-code x:relative x:not-first:mt-[1.25em]","children":["$undefined",["$","pre",null,{"className":"x:group x:focus-visible:nextra-focus x:overflow-x-auto x:subpixel-antialiased x:text-[.9em] x:bg-white x:dark:bg-black x:py-4 x:ring-1 x:ring-inset x:ring-gray-300 x:dark:ring-neutral-700 x:contrast-more:ring-gray-900 x:contrast-more:dark:ring-gray-50 x:contrast-more:contrast-150 x:rounded-md not-prose","tabIndex":"0","children":[["$","div",null,{"className":"x:group-hover:opacity-100 x:group-focus:opacity-100 x:opacity-0 x:transition x:focus-within:opacity-100 x:flex x:gap-1 x:absolute x:right-4 x:top-2","children":[["$","$L26",null,{"children":["$","svg",null,{"viewBox":"0 0 24 24","fill":"currentColor","height":"1em","children":["$","path",null,{"d":"M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"}]}]}],false]}],["$","code",null,{"className":"nextra-code","dir":"ltr","children":[["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},"children":"grep"}],["$","span",null,{"style":{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},"children":" -v"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" DATABASE_URL"}],["$","span",null,{"style":{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},"children":" \\"}]]}],"\n",["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},"children":"    <"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":"./core/.env.local"}],["$","span",null,{"style":{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},"children":" \\"}]]}],"\n",["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},"children":"    >"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":"./.env.docker-compose"}]]}]]}]]}]]}]
3f:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["This cluster will address the local supabase and postgres just like when you are running with ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"pnpm dev"}],", so no need to take extra steps for migrations (though the same ones are needed)."]}]
40:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":"To run the full cluster as local docker-compose, first initialize supabase as you would for development; then do:"}]
41:["$","div",null,{"data-pagefind-ignore":"$undefined","className":"nextra-code x:relative x:not-first:mt-[1.25em]","children":["$undefined",["$","pre",null,{"className":"x:group x:focus-visible:nextra-focus x:overflow-x-auto x:subpixel-antialiased x:text-[.9em] x:bg-white x:dark:bg-black x:py-4 x:ring-1 x:ring-inset x:ring-gray-300 x:dark:ring-neutral-700 x:contrast-more:ring-gray-900 x:contrast-more:dark:ring-gray-50 x:contrast-more:contrast-150 x:rounded-md not-prose","tabIndex":"0","children":[["$","div",null,{"className":"x:group-hover:opacity-100 x:group-focus:opacity-100 x:opacity-0 x:transition x:focus-within:opacity-100 x:flex x:gap-1 x:absolute x:right-4 x:top-2","children":[["$","$L26",null,{"children":["$","svg",null,{"viewBox":"0 0 24 24","fill":"currentColor","height":"1em","children":["$","path",null,{"d":"M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"}]}]}],false]}],["$","code",null,{"className":"nextra-code","dir":"ltr","children":["$","span",null,{"children":["$","span",null,{"children":"docker compose -f docker-compose.dev.yml up"}]}]}]]}]]}]
42:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["you can now address on ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"localhost:3000"}]," as before. note that ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"pnpm dev"}]," uses the same ports and cannot be running at the same time."]}]
43:["$","h2",null,{"id":"prettier","className":"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border","children":["Prettier",["$","$L25",null,{"id":"prettier"}]]}]
44:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":"At the moment, the repo simply uses prettier before adding any additional complexity with ESLint configs. Just auto-format (either on save, or on commit), and let the .prettierrc hold the small subset of decisions."}]
45:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["For a nicer DX, bind ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"Format Document"}]," to a familiar keyboard shortcut so you can format the doc as you go (similar to format-on-save and then saving frequently)."]}]
46:["$","h2",null,{"id":"git-hooks","className":"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border","children":["Git Hooks",["$","$L25",null,{"id":"git-hooks"}]]}]
47:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["Two hooks are defined using ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"husky"}]," and stored in ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":".husky"}],"."]}]
48:["$","ul",null,{"className":"x:[:is(ol,ul)_&]:my-[.75em] x:not-first:mt-[1.25em] x:list-disc x:ms-[1.5em]","children":["\n",["$","li",null,{"className":"x:my-[.5em]","children":"The first runs Prettier on commit"}],"\n",["$","li",null,{"className":"x:my-[.5em]","children":"The second runs a type-check before pushing. Since our deployment setup builds on each push, the intent here is to not trigger a build with known type errors."}],"\n"]}]
49:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["Sometimes you want to push up changes even though there is a type error. To do so, include ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"--no-verify"}]," at the end of your command. For example: ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"git push origin main --no-verify"}],"."]}]
4a:["$","h2",null,{"id":"turborepo-race-conditions","className":"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border","children":["Turborepo race conditions",["$","$L25",null,{"id":"turborepo-race-conditions"}]]}]
4b:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":"We currently have a race condition where dev will sometimes fail because we can‚Äôt specify the order of dependency builds. Tied to the fact that we clean out the dist folder on build, but upstream packages are watching dist."}]
4c:["$","ul",null,{"className":"x:[:is(ol,ul)_&]:my-[.75em] x:not-first:mt-[1.25em] x:list-disc x:ms-[1.5em]","children":["\n",["$","li",null,{"className":"x:my-[.5em]","children":["$","a",null,{"href":"https://github.com/vercel/turbo/discussions/1299?sort=top?sort=top","target":"_blank","rel":"noreferrer","className":"x:focus-visible:nextra-focus x:text-primary-600 x:underline x:hover:no-underline x:decoration-from-font x:[text-underline-position:from-font]","children":["https://github.com/vercel/turbo/discussions/1299?sort=top?sort=top",["¬†",["$","svg",null,{"fill":"none","stroke":"currentColor","strokeLinecap":"round","strokeLinejoin":"round","strokeWidth":1.7,"viewBox":"0 0 24 24","height":"1em","className":"x:inline x:align-baseline x:shrink-0","children":[["$","path",null,{"d":"M7 17L17 7"}],["$","path",null,{"d":"M7 7h10v10"}]]}]]]}]}],"\n",["$","li",null,{"className":"x:my-[.5em]","children":["$","a",null,{"href":"https://github.com/vercel/turbo/issues/460","target":"_blank","rel":"noreferrer","className":"x:focus-visible:nextra-focus x:text-primary-600 x:underline x:hover:no-underline x:decoration-from-font x:[text-underline-position:from-font]","children":["https://github.com/vercel/turbo/issues/460",["¬†",["$","svg",null,{"fill":"none","stroke":"currentColor","strokeLinecap":"round","strokeLinejoin":"round","strokeWidth":1.7,"viewBox":"0 0 24 24","height":"1em","className":"x:inline x:align-baseline x:shrink-0","children":[["$","path",null,{"d":"M7 17L17 7"}],["$","path",null,{"d":"M7 7h10v10"}]]}]]]}]}],"\n"]}]
4d:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":[["$","code",null,{"className":"nextra-code","dir":"ltr","children":"core"}]," depends on ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"ui"}]," which depends on ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"utils"}],". ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"utils"}]," often takes longer to build than it does for ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"ui"}]," to start building, which causes an error to be thrown because ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"utils"}]," d.ts file has been cleared out during its build and hasn‚Äôt been replaced yet. This generates an error, but is quick to resolve, so doesn‚Äôt break actual dev work from beginning. It does make the console output messier though."]}]
4e:["$","h2",null,{"id":"building-and-deploying-for-aws-environments","className":"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border","children":["Building and deploying for AWS environments",["$","$L25",null,{"id":"building-and-deploying-for-aws-environments"}]]}]
4f:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":"All change management to Knowledge Futures‚Äô production environment is done through github actions.\nThis environment runs on AWS ECS and leverages terraform to allow reproducible, parametric environments."}]
50:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":"Services running in AWS ECS are scheduled using ‚ÄúTask Definitions‚Äù, which are CRUDdy resources\nincluding all details for a container. We don‚Äôt want to tie code releases to terraform ‚Äúinfrastructure‚Äù changes,\nbut the service ‚Äúdeclaration‚Äù relies on this Task Definition to exist."}]
51:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":"Therefore based on community patterns we have seen, the flow is roughly this:"}]
52:["$","ol",null,{"className":"x:[:is(ol,ul)_&]:my-[.75em] x:not-first:mt-[1.25em] x:list-decimal x:ms-6","children":["\n",["$","li",null,{"className":"x:my-[.5em]","children":"The infrastructure code in terraform declares a ‚Äútemplate‚Äù Task Definition."}],"\n",["$","li",null,{"className":"x:my-[.5em]","children":"Terraform is told not to change the ‚Äúservice‚Äù based on changes to the Task Definition."}],"\n",["$","li",null,{"className":"x:my-[.5em]","children":"Any changes to the template will be picked up by the next deploy, which is done outside of Terraform."}],"\n",["$","li",null,{"className":"x:my-[.5em]","children":"Github Actions builds new containers on merge, and will use AWS-provided Actions to template the literal correct Task Definition and update the Service."}],"\n"]}]
53:["$","h3",null,{"id":"updating-deployment-topology-andor-environment-variablescontainer-settings","className":"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl","children":["Updating deployment topology and/or environment variables/container settings",["$","$L25",null,{"id":"updating-deployment-topology-andor-environment-variablescontainer-settings"}]]}]
54:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["To change ‚Äúinfrastructure settings‚Äù, which include anything from networking to env vars,\nmake changes to ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"./infrastructure/terraform/aws"}],". Use ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"terraform apply"}]," there to update\nthe infrastructure and/or Task Definition Template. See that directory for more info."]}]
55:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["Then you must perform a Github Actions Deploy, either by pushing your changes to main or\nwith local ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"act"}]," CLI."]}]
56:["$","h3",null,{"id":"updating-container-versions-with-github-actions","className":"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl","children":["Updating container versions with github actions",["$","$L25",null,{"id":"updating-container-versions-with-github-actions"}]]}]
57:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["The core automation workflow can be examined in ",["$","$L18",null,{"href":"./.github/workflows/awsdeploy.yml","prefetch":"$undefined","className":"x:focus-visible:nextra-focus x:text-primary-600 x:underline x:hover:no-underline x:decoration-from-font x:[text-underline-position:from-font]","children":["$","code",null,{"className":"nextra-code","dir":"ltr","children":"awsdeploy.yml"}]}]]}]
58:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":"There is a Dockerfile in this repository that builds a container for one package. You can use it like:"}]
59:["$","div",null,{"data-pagefind-ignore":"$undefined","className":"nextra-code x:relative x:not-first:mt-[1.25em]","children":["$undefined",["$","pre",null,{"className":"x:group x:focus-visible:nextra-focus x:overflow-x-auto x:subpixel-antialiased x:text-[.9em] x:bg-white x:dark:bg-black x:py-4 x:ring-1 x:ring-inset x:ring-gray-300 x:dark:ring-neutral-700 x:contrast-more:ring-gray-900 x:contrast-more:dark:ring-gray-50 x:contrast-more:contrast-150 x:rounded-md not-prose","tabIndex":"0","children":[["$","div",null,{"className":"x:group-hover:opacity-100 x:group-focus:opacity-100 x:opacity-0 x:transition x:focus-within:opacity-100 x:flex x:gap-1 x:absolute x:right-4 x:top-2","children":[["$","$L26",null,{"children":["$","svg",null,{"viewBox":"0 0 24 24","fill":"currentColor","height":"1em","children":["$","path",null,{"d":"M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"}]}]}],false]}],["$","code",null,{"className":"nextra-code","dir":"ltr","children":[["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},"children":"docker"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" build"}],["$","span",null,{"style":{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},"children":" \\"}]]}],"\n",["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},"children":"            --platform"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" linux/amd64"}],["$","span",null,{"style":{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},"children":" \\"}]]}],"\n",["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},"children":"            --build-arg"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" PACKAGE=core"}],["$","span",null,{"style":{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},"children":" \\"}]]}],"\n",["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},"children":"            --build-arg"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" PACKAGE_DIR=core"}],["$","span",null,{"style":{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},"children":" \\"}]]}],"\n",["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},"children":"            -t"}],["$","span",null,{"style":{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},"children":" $ECR_REGISTRY"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":"/"}],["$","span",null,{"style":{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},"children":"$$ECR_REPOSITORY"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":":"}],["$","span",null,{"style":{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},"children":"$$IMAGE_TAG "}],["$","span",null,{"style":{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},"children":"\\"}]]}],"\n",["$","span",null,{"children":["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":"            ."}]}]]}]]}]]}]
5a:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":"Note how this matches the invocation used in the Actions workflow file."}]
5b:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":"We automatically build and push a container to AWS ECR with the github SHA as a tag."}]
5c:["$","h3",null,{"id":"using-act-to-run-the-deploy-events-locally","className":"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl","children":[["Using ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"act"}]," to run the deploy events locally"],["$","$L25",null,{"id":"using-act-to-run-the-deploy-events-locally"}]]}]
5d:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["If you need to build or validate a change and deploy to production, you can use the ",["$","a",null,{"href":"https://github.com/nektos/act","target":"_blank","rel":"noreferrer","className":"x:focus-visible:nextra-focus x:text-primary-600 x:underline x:hover:no-underline x:decoration-from-font x:[text-underline-position:from-font]","children":[[["$","code",null,{"className":"nextra-code","dir":"ltr","children":"act"}]," cli"],false]}],":"]}]
5e:["$","div",null,{"data-pagefind-ignore":"$undefined","className":"nextra-code x:relative x:not-first:mt-[1.25em]","children":["$undefined",["$","pre",null,{"className":"x:group x:focus-visible:nextra-focus x:overflow-x-auto x:subpixel-antialiased x:text-[.9em] x:bg-white x:dark:bg-black x:py-4 x:ring-1 x:ring-inset x:ring-gray-300 x:dark:ring-neutral-700 x:contrast-more:ring-gray-900 x:contrast-more:dark:ring-gray-50 x:contrast-more:contrast-150 x:rounded-md not-prose","tabIndex":"0","children":[["$","div",null,{"className":"x:group-hover:opacity-100 x:group-focus:opacity-100 x:opacity-0 x:transition x:focus-within:opacity-100 x:flex x:gap-1 x:absolute x:right-4 x:top-2","children":[["$","$L26",null,{"children":["$","svg",null,{"viewBox":"0 0 24 24","fill":"currentColor","height":"1em","children":["$","path",null,{"d":"M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"}]}]}],false]}],["$","code",null,{"className":"nextra-code","dir":"ltr","children":[["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},"children":"act"}],["$","span",null,{"style":{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},"children":" \\"}]]}],"\n",["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},"children":"    -W"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" .github/workflows/awsdeploy.yml"}],["$","span",null,{"style":{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},"children":" \\"}]]}],"\n",["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},"children":"    --container-architecture"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" linux/amd64"}],["$","span",null,{"style":{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},"children":" \\"}]]}],"\n",["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},"children":"    --secret-file"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" ~/.aws/pubpub.secrets"}],["$","span",null,{"style":{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},"children":" \\"}]]}],"\n",["$","span",null,{"children":[["$","span",null,{"style":{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},"children":"    -j"}],["$","span",null,{"style":{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},"children":" deploy"}]]}]]}]]}]]}]
5f:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":[["$","strong",null,{"children":["AWS CLI access in ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"act"}],":"]}],"\nWhen you setup ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"act"}]," locally for the first time, you can choose whether to do a Small, Medium, or Large install.\nThe Large install is ",["$","em",null,{"children":"very large"}],", but the medium install does not include the AWS CLI."]}]
60:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["If you choose to work with the medium install, you will need to customize afterward by editing your ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"~/.actrc"}]," file\nto use an image that includes the AWS CLI, for example your .actrc might look like:"]}]
61:["$","div",null,{"data-pagefind-ignore":"$undefined","className":"nextra-code x:relative x:not-first:mt-[1.25em]","children":["$undefined",["$","pre",null,{"className":"x:group x:focus-visible:nextra-focus x:overflow-x-auto x:subpixel-antialiased x:text-[.9em] x:bg-white x:dark:bg-black x:py-4 x:ring-1 x:ring-inset x:ring-gray-300 x:dark:ring-neutral-700 x:contrast-more:ring-gray-900 x:contrast-more:dark:ring-gray-50 x:contrast-more:contrast-150 x:rounded-md not-prose","tabIndex":"0","children":[["$","div",null,{"className":"x:group-hover:opacity-100 x:group-focus:opacity-100 x:opacity-0 x:transition x:focus-within:opacity-100 x:flex x:gap-1 x:absolute x:right-4 x:top-2","children":[["$","$L26",null,{"children":["$","svg",null,{"viewBox":"0 0 24 24","fill":"currentColor","height":"1em","children":["$","path",null,{"d":"M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"}]}]}],false]}],["$","code",null,{"className":"nextra-code","dir":"ltr","children":[["$","span",null,{"children":["$","span",null,{"children":"-P ubuntu-latest=eveships/act-plusplus:latest"}]}],"\n",["$","span",null,{"children":["$","span",null,{"children":"-P ubuntu-22.04=catthehacker/ubuntu:full-22.04"}]}],"\n",["$","span",null,{"children":["$","span",null,{"children":"-P ubuntu-20.04=catthehacker/ubuntu:full-20.04"}]}],"\n",["$","span",null,{"children":["$","span",null,{"children":"-P ubuntu-18.04=catthehacker/ubuntu:full-18.04"}]}]]}]]}]]}]
62:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":[["$","strong",null,{"children":"Secrets:"}]," Though you will have an ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"~/.aws/credentials"}]," file, this is not the format for secrets access that\n",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"act"}]," requires, so I copy the key-value pairs in that file into a file that matches the Github\nsecrets called ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"~/.aws/pubpub.secrets"}],":"]}]
63:["$","div",null,{"data-pagefind-ignore":"$undefined","className":"nextra-code x:relative x:not-first:mt-[1.25em]","children":["$undefined",["$","pre",null,{"className":"x:group x:focus-visible:nextra-focus x:overflow-x-auto x:subpixel-antialiased x:text-[.9em] x:bg-white x:dark:bg-black x:py-4 x:ring-1 x:ring-inset x:ring-gray-300 x:dark:ring-neutral-700 x:contrast-more:ring-gray-900 x:contrast-more:dark:ring-gray-50 x:contrast-more:contrast-150 x:rounded-md not-prose","tabIndex":"0","children":[["$","div",null,{"className":"x:group-hover:opacity-100 x:group-focus:opacity-100 x:opacity-0 x:transition x:focus-within:opacity-100 x:flex x:gap-1 x:absolute x:right-4 x:top-2","children":[["$","$L26",null,{"children":["$","svg",null,{"viewBox":"0 0 24 24","fill":"currentColor","height":"1em","children":["$","path",null,{"d":"M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"}]}]}],false]}],["$","code",null,{"className":"nextra-code","dir":"ltr","children":[["$","span",null,{"children":["$","span",null,{"children":"AWS_ACCESS_KEY_ID=..."}]}],"\n",["$","span",null,{"children":["$","span",null,{"children":"AWS_SECRET_ACCESS_KEY..."}]}]]}]]}]]}]
64:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":[["$","strong",null,{"children":"Dirty worktree:"}]," If you run ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"act"}]," like this, the image will be conveniently tagged with the latest SHA plus ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"-dirty"}],".\nImages tagged with a SHA alone should be idempotently built, but ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"-dirty"}]," can be changed/overwritten."]}]
65:["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["$","strong",null,{"children":"TODO:"}]}]
66:["$","ul",null,{"className":"contains-task-list","children":["\n",["$","li",null,{"className":"task-list-item","children":[["$","input",null,{"type":"checkbox","disabled":true}]," ","allow deploying without a rebuild, so that a rollback is convenient"]}],"\n"]}]
a:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
67:I[77462,["/platform/pr-preview/pr-1389/_next/static/chunks/aeacce398bb52d2f.js","/platform/pr-preview/pr-1389/_next/static/chunks/688156694ad04c7c.js"],"IconMark"]
c:[["$","title","0",{"children":"Getting started | PubPub Developer Docs"}],["$","link","1",{"rel":"icon","href":"/platform/pr-preview/pr-1389/favicon.ico?favicon.2c9e1857.ico","sizes":"48x48","type":"image/x-icon"}],["$","$L67","2",{}]]
8:null
